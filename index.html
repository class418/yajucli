<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>野獣先輩クリックゲーム</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<style>
  body {
    margin: 0;
    padding: 0;
    background: #282c34;
    color: #fff;
    font-family: Arial, sans-serif;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }
  #leftPanel, #centerPanel, #rightPanel {
    padding: 10px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  #leftPanel {
    flex: 0 0 30%;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }
  #centerPanel {
    flex: 0 0 40%;
    background: #333;
    display: flex;
    flex-wrap: wrap;
    align-content: flex-start;
    gap: 5px;
  }
  #rightPanel {
    flex: 0 0 30%;
    background: #222;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
  }
  #clickerBtn {
    width: 180px;
    height: 180px;
    border-radius: 15px;
    object-fit: contain;
    animation: spin 5s linear infinite;
    cursor: pointer;
    user-select: none;
    transition: transform 0.15s ease;
  }
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  #scoreDisplay {
    font-size: 24px;
    margin-top: 10px;
    text-align: center;
  }
  #autoClickDisplay {
    position: absolute;
    top: 5px;
    background: rgba(0,0,0,0.4);
    padding: 2px 6px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    color: #ffeb3b;
    text-shadow: 0 0 4px #000;
  }
  .facilityIcon {
    width: 64px;
    height: 64px;
    object-fit: contain;
  }
  .sectionTitle {
    font-weight: bold;
    margin: 10px 0 5px;
    border-bottom: 1px solid #555;
  }
  .buyButton {
    background: #444;
    border-radius: 8px;
    padding: 8px;
    margin-bottom: 8px;
    cursor: pointer;
    user-select: none;
  }
  .buyButton.disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  .buyButton:hover:not(.disabled) {
    background: #666;
  }
</style>
</head>
<body>

<div id="leftPanel">
  <div id="autoClickDisplay">自動0.0/秒</div>
  <img id="clickerBtn" src="./assets/yajuu.png" alt="野獣先輩">
  <div id="scoreDisplay">ポイント: 0</div>
</div>

<div id="centerPanel" id="facilityDisplay">
  <!-- 購入施設がここに並ぶ -->
</div>

<div id="rightPanel">
  <div>
    <div class="sectionTitle">施設購入</div>
    <div id="facilityButtons"></div>
  </div>
  <div>
    <div class="sectionTitle">アップグレード</div>
    <div id="upgradeButtons"></div>
  </div>
</div>

<script>
let points = 0;
let clickPowerLevel = 0;
let autoClickLevel = 0;
let takuyaLevel = 0;

const clickerBtn = document.getElementById('clickerBtn');
const scoreDisplay = document.getElementById('scoreDisplay');
const autoClickDisplay = document.getElementById('autoClickDisplay');
const facilityButtons = document.getElementById('facilityButtons');
const upgradeButtons = document.getElementById('upgradeButtons');
const centerPanel = document.getElementById('centerPanel');

let autoClickInterval = null;
const AudioContext = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;
let clickBuffer = null;

function initAudioContext() {
  if (!audioCtx) audioCtx = new AudioContext();
}
function loadClickSound() {
  fetch('./assets/click.mp3')
    .then(r => r.arrayBuffer())
    .then(buf => audioCtx.decodeAudioData(buf))
    .then(decoded => clickBuffer = decoded);
}
function playClickSound() {
  if (!clickBuffer || !audioCtx) return;
  const src = audioCtx.createBufferSource();
  src.buffer = clickBuffer;
  src.connect(audioCtx.destination);
  src.start();
}

function calcPrice(base, level) {
  return Math.floor(base * Math.pow(1.15, level));
}
function pointsPerClick() {
  return 1 * (1 + 0.2 * clickPowerLevel);
}
function autoClickPerSec() {
  return autoClickLevel * 0.1 + takuyaLevel * 1.0;
}
function updateAutoClickDisplay() {
  autoClickDisplay.textContent = `自動${autoClickPerSec().toFixed(1)}/秒`;
}
function updateScore() {
  scoreDisplay.textContent = `ポイント: ${points.toFixed(1)}`;
  updateButtons();
}
function addFacilityImage(src) {
  const img = document.createElement('img');
  img.src = src;
  img.classList.add('facilityIcon');
  centerPanel.appendChild(img);
}

function startAutoClick() {
  if (autoClickInterval) return;
  autoClickInterval = setInterval(() => {
    points += autoClickPerSec();
    updateScore();
    playClickSound();
  }, 1000);
}

const facilities = [
  { id:'cursor', name:'自動クリック', baseCost:10, level:0, icon:'./assets/cursor.png',
    onBuy: function(){
      this.level++;
      autoClickLevel = this.level;
      addFacilityImage(this.icon);
      updateAutoClickDisplay();
      if (autoClickLevel > 0) startAutoClick();
    }
  },
  { id:'takuya', name:'拓也さん', baseCost:100, level:0, icon:'./assets/takuya.png',
    onBuy: function(){
      this.level++;
      takuyaLevel = this.level;
      addFacilityImage(this.icon);
      updateAutoClickDisplay();
      if (takuyaLevel > 0) startAutoClick();
    }
  }
];
const upgrades = [
  { id:'clickPower', name:'クリック力強化', baseCost:50, level:0,
    onBuy:function(){
      this.level++;
      clickPowerLevel = this.level;
    }
  }
];

function createButtons() {
  facilities.forEach(f => {
    const btn = document.createElement('div');
    btn.id = 'facility-'+f.id;
    btn.classList.add('buyButton');
    facilityButtons.appendChild(btn);
  });
  upgrades.forEach(u => {
    const btn = document.createElement('div');
    btn.id = 'upgrade-'+u.id;
    btn.classList.add('buyButton');
    upgradeButtons.appendChild(btn);
  });
  updateButtons();
}

function updateButtons() {
  facilities.forEach(f => {
    const btn = document.getElementById('facility-'+f.id);
    const price = calcPrice(f.baseCost, f.level);
    btn.textContent = `${f.name} Lv.${f.level} - ${price}pt`;
    if (points >= price) {
      btn.classList.remove('disabled');
      btn.onclick = () => {
        if (points >= price) {
          points -= price;
          f.onBuy();
          updateScore();
        }
      };
    } else {
      btn.classList.add('disabled');
      btn.onclick = null;
    }
  });
  upgrades.forEach(u => {
    const btn = document.getElementById('upgrade-'+u.id);
    const price = calcPrice(u.baseCost, u.level);
    btn.textContent = `${u.name} Lv.${u.level} - ${price}pt`;
    if (points >= price) {
      btn.classList.remove('disabled');
      btn.onclick = () => {
        if (points >= price) {
          points -= price;
          u.onBuy();
          updateScore();
        }
      };
    } else {
      btn.classList.add('disabled');
      btn.onclick = null;
    }
  });
}

function playPuniAnimation() {
  clickerBtn.style.transform = 'scale(1.1,0.9)';
  setTimeout(()=>clickerBtn.style.transform = 'scale(1,1)',100);
}

clickerBtn.addEventListener('click', () => {
  initAudioContext();
  if (audioCtx.state === 'suspended') audioCtx.resume();
  points += pointsPerClick();
  updateScore();
  playClickSound();
  playPuniAnimation();
});

window.addEventListener('load', () => {
  initAudioContext();
  loadClickSound();
  updateAutoClickDisplay();
  createButtons();
  updateScore();
});
</script>

</body>
</html>
